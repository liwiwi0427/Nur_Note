<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«ç·¨è¼¯å™¨</title>
    <script src="database.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #2c3e50; color: white; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #34495e; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        h2 { border-bottom: 2px solid #e74c3c; padding-bottom: 10px; margin-top: 0;}
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #ecf0f1; }
        input, select, textarea {
            width: 100%; padding: 10px; border-radius: 5px; border: none; font-size: 16px; box-sizing: border-box;
        }
        input, select { height: 40px; }
        textarea { height: 100px; font-family: monospace; }
        
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .btn-add { background: #27ae60; color: white; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-add:hover { background: #2ecc71; }
        
        .btn-save { background: #e67e22; color: white; padding: 15px; width: 100%; font-size: 18px; cursor: pointer; margin-top: 30px; border-radius: 5px; border:none; font-weight: bold;}
        .btn-save:hover { background: #d35400; }

        .hint { font-size: 12px; color: #bdc3c7; margin-top: 5px; }
        
        /* é è¦½ç¾æœ‰è³‡æ–™å€ */
        .preview-box { margin-top: 30px; background: #2c3e50; padding: 15px; border-radius: 5px; max-height: 200px; overflow-y: auto; border: 1px solid #7f8c8d; }
        pre { margin: 0; font-size: 12px; color: #ecf0f1; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ› ï¸ æ–°å¢è­·ç†è¨˜éŒ„å…§å®¹</h2>

    <div class="row">
        <div class="form-group">
            <label>1. ä¸»è™•ç½® (Main)</label>
            <input type="text" id="inputMain" list="mainList" placeholder="ä¾‹å¦‚: Foley">
            <datalist id="mainList"></datalist>
            <div class="hint">å¯ç›´æ¥æ‰“å­—æ–°å¢ï¼Œæˆ–å¾é¸å–®é¸ç¾æœ‰çš„</div>
        </div>
        <div class="form-group">
            <label>2. åˆ†é¡ (Category)</label>
            <input type="text" id="inputCat" placeholder="ä¾‹å¦‚: ç½®å…¥">
        </div>
    </div>

    <div class="form-group">
        <label>3. è¨˜éŒ„æ¨™é¡Œ (Title)</label>
        <input type="text" id="inputTitle" placeholder="ä¾‹å¦‚: å›°é›£ç½®å…¥">
    </div>

    <div class="form-group">
        <label>4. è¨˜éŒ„å…§å®¹ (Template)</label>
        <textarea id="inputContent" placeholder="å…§å®¹ç¯„ä¾‹ï¼šFoley size {{size}} inserted..."></textarea>
        <div class="hint">æç¤ºï¼šä½¿ç”¨ {{è®Šæ•¸åç¨±}} ä¾†å»ºç«‹å¡«ç©ºæ ¼</div>
    </div>

    <button class="btn-add" onclick="addItem()">â• åŠ å…¥æš«å­˜</button>

    <div class="preview-box">
        <label>ç›®å‰è³‡æ–™åº«å…§å®¹é è¦½ï¼š</label>
        <pre id="jsonPreview"></pre>
    </div>

    <button class="btn-save" onclick="saveFile()">ğŸ’¾ åŒ¯å‡ºä¸¦å–ä»£ database.js</button>
</div>

<script>
    // è¼‰å…¥ç¾æœ‰è³‡æ–™
    let currentData = window.nursingData || {};

    // åˆå§‹åŒ–é¸å–®åˆ—è¡¨
    function initList() {
        const list = document.getElementById('mainList');
        list.innerHTML = '';
        Object.keys(currentData).forEach(key => {
            let opt = document.createElement('option');
            opt.value = key;
            list.appendChild(opt);
        });
        updatePreview();
    }

    function updatePreview() {
        document.getElementById('jsonPreview').innerText = JSON.stringify(currentData, null, 2);
    }

    function addItem() {
        const main = document.getElementById('inputMain').value.trim();
        const cat = document.getElementById('inputCat').value.trim();
        const title = document.getElementById('inputTitle').value.trim();
        const content = document.getElementById('inputContent').value.trim();

        if (!main || !cat || !title || !content) {
            alert("æ‰€æœ‰æ¬„ä½éƒ½å¿…é ˆå¡«å¯«ï¼");
            return;
        }

        // å»ºæ§‹è³‡æ–™çµæ§‹
        if (!currentData[main]) currentData[main] = {};
        if (!currentData[main][cat]) currentData[main][cat] = {};
        
        currentData[main][cat][title] = content;

        alert(`å·²åŠ å…¥ï¼š${title}`);
        
        // æ¸…ç©ºéƒ¨åˆ†æ¬„ä½æ–¹ä¾¿ç¹¼çºŒè¼¸å…¥
        document.getElementById('inputTitle').value = '';
        document.getElementById('inputContent').value = '';
        
        initList(); // æ›´æ–°é¸å–®èˆ‡é è¦½
    }

    function saveFile() {
        // ç”¢ç”Ÿæª”æ¡ˆå…§å®¹
        const fileContent = `window.nursingData = ${JSON.stringify(currentData, null, 4)};`;
        
        // å»ºç«‹ Blob ç‰©ä»¶
        const blob = new Blob([fileContent], { type: "text/javascript" });
        const url = URL.createObjectURL(blob);
        
        // å»ºç«‹ä¸‹è¼‰é€£çµ
        const a = document.createElement('a');
        a.href = url;
        a.download = "database.js";
        document.body.appendChild(a);
        a.click();
        
        // æ¸…ç†
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("æª”æ¡ˆå·²ä¸‹è¼‰ï¼è«‹å°‡ä¸‹è¼‰çš„ 'database.js' è¦†è“‹æ‰åŸæœ¬è³‡æ–™å¤¾ä¸­çš„æª”æ¡ˆå³å¯å®Œæˆæ›´æ–°ã€‚");
    }

    window.onload = initList;
</script>

</body>
</html>
