<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«ç·¨è¼¯å™¨</title>
    <!-- 1. å¼•å…¥æ¨£å¼è¡¨ -->
    <link rel="stylesheet" href="style.css">
    <script src="database.js"></script>
</head>
<body>

<div class="container">
    <h2>ğŸ› ï¸ è³‡æ–™åº«ç·¨è¼¯å¾Œå°</h2>

    <div class="row">
        <div class="form-group">
            <label>1. ä¸»è™•ç½® (Main)</label>
            <input type="text" id="inputMain" list="mainList" placeholder="ä¾‹å¦‚: Foley">
            <datalist id="mainList"></datalist>
            <div class="hint">å¯ç›´æ¥è¼¸å…¥æ–°åç¨±ï¼Œæˆ–é¸æ“‡ç¾æœ‰</div>
        </div>
        <div class="form-group">
            <label>2. åˆ†é¡ (Category)</label>
            <input type="text" id="inputCat" placeholder="ä¾‹å¦‚: ç½®å…¥">
        </div>
    </div>

    <div class="form-group">
        <label>3. è¨˜éŒ„æ¨™é¡Œ (Title)</label>
        <input type="text" id="inputTitle" placeholder="ä¾‹å¦‚: å›°é›£ç½®å…¥">
    </div>

    <div class="form-group">
        <label>4. è¨˜éŒ„å…§å®¹æ¨¡æ¿ (Template)</label>
        <textarea id="inputContent" placeholder="å…§å®¹ç¯„ä¾‹ï¼šFoley size {{size}} inserted..."></textarea>
        <div class="hint">ğŸ’¡ æç¤ºï¼šä½¿ç”¨ {{è®Šæ•¸}} ä¾†å»ºç«‹å¡«ç©ºæ ¼</div>
    </div>

    <button class="btn-secondary" onclick="addItem()">â• åŠ å…¥æš«å­˜åˆ—è¡¨</button>

    <div class="form-group" style="margin-top: 30px;">
        <label>ç›®å‰è³‡æ–™åº«é è¦½</label>
        <div class="preview-box">
            <pre id="jsonPreview" style="margin:0;"></pre>
        </div>
    </div>

    <button class="btn-danger" onclick="saveFile()">ğŸ’¾ ä¸‹è¼‰æ–°è³‡æ–™åº« (è¦†è“‹ database.js)</button>
</div>

<script>
    let currentData = window.nursingData || {};

    function initList() {
        const list = document.getElementById('mainList');
        list.innerHTML = '';
        Object.keys(currentData).forEach(key => {
            let opt = document.createElement('option');
            opt.value = key;
            list.appendChild(opt);
        });
        updatePreview();
    }

    function updatePreview() {
        document.getElementById('jsonPreview').innerText = JSON.stringify(currentData, null, 2);
    }

    function addItem() {
        const main = document.getElementById('inputMain').value.trim();
        const cat = document.getElementById('inputCat').value.trim();
        const title = document.getElementById('inputTitle').value.trim();
        const content = document.getElementById('inputContent').value.trim();

        if (!main || !cat || !title || !content) {
            alert("âš ï¸ æ‰€æœ‰æ¬„ä½éƒ½å¿…é ˆå¡«å¯«ï¼");
            return;
        }

        if (!currentData[main]) currentData[main] = {};
        if (!currentData[main][cat]) currentData[main][cat] = {};
        currentData[main][cat][title] = content;

        alert(`âœ… å·²åŠ å…¥ï¼š${title}`);
        
        // æ¸…ç©ºä¸‹æ–¹æ¬„ä½ï¼Œä¿ç•™ä¸»åˆ†é¡æ–¹ä¾¿é€£çºŒè¼¸å…¥
        document.getElementById('inputTitle').value = '';
        document.getElementById('inputContent').value = '';
        initList();
    }

    function saveFile() {
        const fileContent = `window.nursingData = ${JSON.stringify(currentData, null, 4)};`;
        const blob = new Blob([fileContent], { type: "text/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "database.js";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("â¬‡ï¸ æª”æ¡ˆå·²ä¸‹è¼‰ï¼\nè«‹å°‡ä¸‹è¼‰çš„æª”æ¡ˆè¦†è“‹åŸæœ¬çš„ database.js");
    }

    window.onload = initList;
</script>

</body>
</html>
